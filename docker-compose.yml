version: "3.6"

services:
  db:
    image: postgres:9.6
    # https://docs.docker.com/compose/compose-file/#ports
    ports:
      - "5432"
    # https://docs.docker.com/compose/compose-file/#volumes
    volumes:
      - postgres:/var/lib/postgresql/data
    # https://docs.docker.com/compose/compose-file/#restart_policy
  app:
    build: .
    command: mix do ecto.create, ecto.migrate, phx.server
    environment:
      DB_URL: "ecto://postgres@db:5432/changelog_dev"
    ports:
      - "4000:4000"
    volumes:
      - uploads:/uploads
    depends_on:
      - db
  # proxy:
  #   image: nginx
  #   volumes:
  #   - /data/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
  #   - /data/nginx/conf.d:/etc/nginx/conf.d:ro
  #   - /data/nginx/sites:/etc/nginx/sites:ro
  #   - /data/nginx/:/var/www:ro

volumes:
  postgres:
  uploads:
